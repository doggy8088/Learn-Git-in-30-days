# Day 18: Fixing Committed Version History Part 1 (reset & amend)

Sometimes after making commits, you realize you made a mistake - maybe you committed too early, included the wrong files, or want to change the commit message. Git provides several ways to fix committed history. This article introduces `git reset` and `git commit --amend`.

## Understanding git commit --amend

The `--amend` option allows you to modify the most recent commit. This is useful when you:

* Want to change the commit message
* Forgot to include some files
* Need to fix a small mistake in the last commit

### Changing the Last Commit Message

```
git commit --amend -m "New commit message"
```

### Adding Files to the Last Commit

```
# Make changes or add forgotten files
git add forgotten-file.txt

# Amend the commit
git commit --amend --no-edit
```

The `--no-edit` flag keeps the existing commit message.

### Interactive Amend

To edit the commit message in your editor:

```
git commit --amend
```

This opens your configured editor where you can modify the commit message.

## Understanding git reset

`git reset` is a powerful command that can:

* Move the current branch pointer
* Modify the staging area (index)
* Modify the working directory

There are three modes of reset:

1. **--soft**: Moves HEAD, keeps staging area and working directory unchanged
2. **--mixed** (default): Moves HEAD, resets staging area, keeps working directory unchanged
3. **--hard**: Moves HEAD, resets staging area and working directory

## Soft Reset

Moves the branch pointer but keeps your changes staged:

```
git reset --soft HEAD~1
```

This undoes the last commit but leaves your changes in the staging area, ready to be recommitted.

## Mixed Reset

Moves the branch pointer and unstages changes:

```
git reset HEAD~1
# or
git reset --mixed HEAD~1
```

This undoes the last commit and unstages the changes, but the changes remain in your working directory.

## Hard Reset

Completely discards the commit and all changes:

```
git reset --hard HEAD~1
```

**Warning**: This permanently discards changes. Use with caution!

## Resetting to a Specific Commit

You can reset to any commit:

```
# Using commit hash
git reset --hard a1b2c3d

# Using relative reference
git reset --soft HEAD~3
```

## Unstaging Files

To unstage a file without losing changes:

```
git reset HEAD file.txt
# or
git restore --staged file.txt
```

## Recovering from Reset

If you reset by mistake, you can usually recover using reflog:

```
git reflog
git reset --hard HEAD@{2}
```

## Reset vs Revert

Important distinction:

* **reset**: Rewrites history (use for local, unpushed commits)
* **revert**: Creates a new commit that undoes changes (safe for shared history)

## Common Use Cases

### Undo Last Commit, Keep Changes

```
git reset HEAD~1
```

### Undo Last Commit, Discard Changes

```
git reset --hard HEAD~1
```

### Split One Commit into Multiple

```
git reset HEAD~1
git add file1.txt
git commit -m "First part"
git add file2.txt
git commit -m "Second part"
```

### Change Last Few Commits

```
git reset --soft HEAD~3
# Make changes
git commit -m "Combined commit"
```

## Warnings and Best Practices

1. **Never reset public history**: Don't reset commits that have been pushed to shared repositories
2. **Use --amend carefully**: Only amend commits that haven't been pushed
3. **Consider alternatives**: For shared history, use `git revert` instead
4. **Check twice**: Especially before using `--hard`
5. **Know your reflog**: It can save you from mistakes

## Today's Summary

`git commit --amend` and `git reset` are powerful tools for fixing local commit history. `--amend` is perfect for quick fixes to the last commit, while `reset` gives you more control over multiple commits. However, both should be used carefully, especially for commits that have been shared with others.

Let me reorganize the Git commands and parameters learned today:

* git commit --amend
* git commit --amend --no-edit
* git reset --soft
* git reset --mixed
* git reset --hard
* git reset HEAD~n
* git reflog

---

* [Back to Table of Contents](README.md)
* [Previous Day: Basic Concepts and Usage of Merging](17.md)
* [Next Day: Setting .gitignore Ignore List](19.md)

---
